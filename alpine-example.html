<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Template Form Editor - Alpine.js</title>
    <link rel="stylesheet" href="styles.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body x-data="formEditor()">
    <header class="app-header">
      <div>
        <h1>Template Form Editor</h1>
        <p>Build and edit form templates based on JSON sections and fields. <strong>(Alpine.js version)</strong></p>
      </div>
      <div class="header-actions">
        <button type="button" @click="loadSample">Load Sample</button>
        <button type="button" class="primary" @click="exportJson">Export JSON</button>
      </div>
    </header>

    <main class="app-body">
      <section class="builder">
        <div class="builder-header">
          <h2>Sections</h2>
          <button type="button" @click="addSection">Add section</button>
        </div>
        
        <div class="sections">
          <template x-for="section in sections" :key="section.id">
            <article class="section-card">
              <header class="section-header">
                <div class="field">
                  <label>Section title</label>
                  <input type="text" x-model="section.title" />
                </div>
                <div class="section-actions">
                  <button type="button" @click="addField(section)">Add field</button>
                  <button type="button" class="ghost" @click="removeSection(section.id)">Remove</button>
                </div>
              </header>
              
              <div class="fields">
                <template x-for="field in section.fields" :key="field.id">
                  <div class="field-row">
                    <div class="field">
                      <label>Label</label>
                      <input type="text" x-model="field.label" />
                    </div>
                    <div class="field">
                      <label>Type</label>
                      <select x-model="field.type">
                        <option value="text">Text</option>
                        <option value="number">Number</option>
                        <option value="date">Date</option>
                        <option value="jpg">Photo (jpg)</option>
                        <option value="email">Email</option>
                        <option value="phone">Phone number</option>
                        <option value="textarea">Textarea</option>
                      </select>
                    </div>
                    <div class="field inline">
                      <label>Required</label>
                      <input type="checkbox" x-model="field.required" />
                    </div>
                    <button type="button" class="ghost" @click="removeField(section, field.id)">Remove</button>
                  </div>
                </template>
              </div>
            </article>
          </template>
          
          <!-- Empty state -->
          <div x-show="sections.length === 0" class="empty-state">
            <p>No sections yet. Click "Add section" to get started!</p>
          </div>
        </div>
      </section>

      <aside class="preview">
        <h2>JSON Output</h2>
        <textarea x-text="jsonOutput" spellcheck="false" readonly></textarea>
        <div class="hint">
          Tip: Edit fields on the left to update this JSON output.
        </div>
      </aside>
    </main>

    <script>
      function formEditor() {
        return {
          sections: [],

          // Computed property for JSON output
          get jsonOutput() {
            return JSON.stringify({ sections: this.sections }, null, 2);
          },

          // Generate unique ID
          generateId() {
            return Date.now() + Math.floor(Math.random() * 1000);
          },

          // Create a default field
          createField() {
            return {
              id: this.generateId(),
              label: 'New field',
              type: 'text',
              required: false
            };
          },

          // Create a default section
          createSection() {
            return {
              id: this.generateId(),
              title: 'New section',
              fields: [this.createField()]
            };
          },

          // Add a new section
          addSection() {
            this.sections.push(this.createSection());
          },

          // Remove a section by ID
          removeSection(sectionId) {
            this.sections = this.sections.filter(s => s.id !== sectionId);
          },

          // Add a field to a section
          addField(section) {
            section.fields.push(this.createField());
          },

          // Remove a field from a section
          removeField(section, fieldId) {
            section.fields = section.fields.filter(f => f.id !== fieldId);
            // Ensure at least one field exists
            if (section.fields.length === 0) {
              section.fields.push(this.createField());
            }
          },

          // Load sample data
          loadSample() {
            this.sections = [
              {
                id: this.generateId(),
                title: 'Personal Information',
                fields: [
                  { id: this.generateId(), label: 'Full Name', type: 'text', required: true },
                  { id: this.generateId(), label: 'Email Address', type: 'email', required: true },
                  { id: this.generateId(), label: 'Phone Number', type: 'phone', required: false },
                  { id: this.generateId(), label: 'Date of Birth', type: 'date', required: false }
                ]
              },
              {
                id: this.generateId(),
                title: 'Project Details',
                fields: [
                  { id: this.generateId(), label: 'Project Name', type: 'text', required: true },
                  { id: this.generateId(), label: 'Budget', type: 'number', required: true },
                  { id: this.generateId(), label: 'Description', type: 'textarea', required: false },
                  { id: this.generateId(), label: 'Project Photo', type: 'jpg', required: false }
                ]
              }
            ];
          },

          // Export JSON to clipboard
          async exportJson() {
            try {
              await navigator.clipboard.writeText(this.jsonOutput);
              alert('JSON copied to clipboard!');
            } catch (err) {
              // Fallback: select the textarea content
              const textarea = document.querySelector('#json-output');
              if (textarea) {
                textarea.select();
                document.execCommand('copy');
                alert('JSON copied to clipboard!');
              } else {
                alert('Could not copy to clipboard. Please copy manually from the JSON output.');
              }
            }
          },

          // Initialize with one section
          init() {
            this.addSection();
          }
        };
      }
    </script>

    <style>
      /* Additional styles for empty state */
      .empty-state {
        text-align: center;
        padding: 40px;
        color: #6a7182;
        border: 2px dashed #e3e6ef;
        border-radius: 12px;
      }

      /* Make textarea display the JSON properly */
      .preview textarea {
        white-space: pre;
        font-family: 'Consolas', 'Monaco', monospace;
      }
    </style>
  </body>
</html>
